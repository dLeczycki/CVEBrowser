import React from 'react';
import {
  List,
  Box,
  Text,
} from '@chakra-ui/react';
import { useTranslation } from 'react-i18next';

import CVEListElement from './CVEListElement';

const CVEList = ({ queryResult }) => {
  const { t } = useTranslation();
  const foundT = t('cve-search-results.found');
  const matchingVulnerabilitiesT = t('cve-search-results.matching-vulnerabilities');

  const { totalResults } = queryResult;
  const cveList = queryResult.result.CVE_Items;
  const cveListElements = cveList.map((cve) => {
    const cveId = cve.cve.CVE_data_meta.ID;
    const description = cve.cve.description.description_data[0].value;
    const problemTypes = cve.cve.problemtype.problemtype_data;
    const references = cve.cve.references.reference_data.map((reference) => reference.url);
    const cvssV3Metric = cve.impact.baseMetricV3?.cvssV3;
    const { lastModifiedDate, publishedDate } = cve;

    return (
      <CVEListElement
        key={cveId}
        cveId={cveId}
        description={description}
        problemTypes={problemTypes}
        references={references}
        cvssV3Metric={cvssV3Metric}
        lastModifiedDate={lastModifiedDate}
        publishedDate={publishedDate}
      />
    );
  });

  return (
    <Box as="section" height="100%">
      <Text fontWeight="bold" textDecoration="underline" pt={2} textAlign={['center', 'center', 'left']}>
        {foundT}
        {' '}
        {totalResults}
        {' '}
        {matchingVulnerabilitiesT}
      </Text>
      <List as="ul" height="100%">
        {cveListElements}
      </List>
    </Box>
  );
};

export default CVEList;
