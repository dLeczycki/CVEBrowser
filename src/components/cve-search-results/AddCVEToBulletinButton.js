import React, { useContext } from 'react';
import { useToast } from '@chakra-ui/react';
import { useTranslation } from 'react-i18next';

import { BulletinContext } from '../../context/BulletinContext';

import SuccessButton from '../../common/SuccessButton';

const AddCVEToBulletinButton = (props) => {
  const { t } = useTranslation();
  const addToBulletinT = t('cve-search-results.add-to-bulletin');
  const addedToBulletinT = t('cve-search-results.added-to-bulletin');
  const alreadyInBulletinT = t('cve-search-results.already-in-bulletin');

  const {
    isButtonDisabled, setButtonDisabled, cve, ...style
  } = props;

  const { addCveToBulletin } = useContext(BulletinContext);
  const toast = useToast();

  const handleAddToBulletin = () => {
    const addedToBulletin = addCveToBulletin(cve);
    if (addedToBulletin) {
      toast({
        title: `${cve.cveId} ${addedToBulletinT}`,
        status: 'success',
        duration: 2000,
        isClosable: true,
      });
      setButtonDisabled.on();
    } else {
      toast({
        title: `${cve.cveId} ${alreadyInBulletinT}`,
        status: 'error',
        duration: 2000,
        isClosable: true,
      });
    }
  };

  return (
    <SuccessButton
      p={2}
      flexBasis={['unset', 'unset', '30%', '20%']}
      disabled={isButtonDisabled}
      onClick={handleAddToBulletin}
      {...style}
    >
      {addToBulletinT}
    </SuccessButton>
  );
};

export default AddCVEToBulletinButton;
