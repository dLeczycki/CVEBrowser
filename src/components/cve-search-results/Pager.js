import React, { useContext } from 'react';
import { useHistory } from 'react-router-dom';
import { Center, Text } from '@chakra-ui/react';

import { SettingsContext } from '../../context/SettingsContext';
import Button from '../../common/Button';
import { scrollToTop } from '../../helpers/scrollToTop';

const Pager = ({ searchParams, totalResults, page }) => {
  const { suplementaryColorHover } = useContext(SettingsContext);

  const selectedPage = page || 1;
  const history = useHistory();
  const { pageSize } = searchParams;
  const pageNumber = Math.ceil(totalResults / pageSize);

  const goToPage = (pageId) => {
    scrollToTop();
    history.push({
      pathname: `/cve-search/results/${pageId}`,
      state: searchParams,
    });
  };

  const createPager = () => {
    const pager = [];
    const firstPage = 1;
    const lastPage = pageNumber;
    const maxDistance = 4;

    for (let i = firstPage; i <= lastPage; i += 1) {
      if (i === firstPage
        || i === lastPage
        || (i > selectedPage - maxDistance && i < selectedPage + maxDistance)) {
        if (i === selectedPage) {
          pager.push(
            <Button bgColor={suplementaryColorHover} key={i} onClick={() => goToPage(i)} mx={1}>
              {i}
            </Button>,
          );
        } else {
          pager.push(<Button key={i} onClick={() => goToPage(i)} mx={1}>{i}</Button>);
        }
      }
    }

    if (selectedPage > maxDistance) pager.splice(1, 0, <Text key="pre-divider" px={2}>...</Text>);
    if (selectedPage < lastPage - maxDistance) {
      pager.splice(pager.length - 1, 0, <Text key="post-divider" px={2}>...</Text>);
    }

    return pager;
  };

  const pager = createPager();

  return (<Center as="section">{pager}</Center>);
};

export default Pager;
