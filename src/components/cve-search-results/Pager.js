import React, { useContext } from 'react';
import { useHistory } from 'react-router-dom';
import { Center, Text } from '@chakra-ui/react';

import { SettingsContext } from '../../context/SettingsContext';
import PrimaryButton from '../../common/PrimaryButton';

import { scrollToTop } from '../../helpers/utils';

const Pager = ({ searchParams, totalResults, page }) => {
  const { primaryColorHover } = useContext(SettingsContext);

  const selectedPage = page || 1;
  const history = useHistory();
  const { pageSize } = searchParams;
  const pageNumber = Math.ceil(totalResults / pageSize);

  const goToPage = (pageId) => {
    scrollToTop();
    history.push({
      pathname: `/cve-search/results/${pageId}`,
      state: searchParams,
    });
  };

  const createPager = () => {
    const pager = [];
    const firstPage = 1;
    const lastPage = pageNumber;
    const maxDistance = 4;

    for (let i = firstPage; i <= lastPage; i += 1) {
      if (i === firstPage
        || i === lastPage
        || (i > selectedPage - maxDistance && i < selectedPage + maxDistance)) {
        if (i === selectedPage) {
          pager.push(
            <PrimaryButton
              bgColor={primaryColorHover}
              key={i}
              onClick={() => goToPage(i)}
              mx={1}
            >
              {i}
            </PrimaryButton>,
          );
        } else {
          pager.push(
            <PrimaryButton
              key={i}
              onClick={() => goToPage(i)}
              mx={1}
            >
              {i}
            </PrimaryButton>,
          );
        }
      }
    }

    if (selectedPage > maxDistance) pager.splice(1, 0, <Text key="pre-divider" px={2}>...</Text>);
    if (selectedPage < lastPage - maxDistance) {
      pager.splice(pager.length - 1, 0, <Text key="post-divider" px={2}>...</Text>);
    }

    return pager;
  };

  const pager = createPager();

  return (<Center as="section" mt="auto">{pager}</Center>);
};

export default Pager;
